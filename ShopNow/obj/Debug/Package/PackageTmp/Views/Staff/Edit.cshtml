@model ShopNow.ViewModels.StaffCreateEditViewModel
@{
    ViewBag.Title = "Staff Update";
}
<title>ShopNow | Staff Edit</title>

<style>
    .img-upload-container {
        position: relative;
        width: 120px;
        height: 120px;
        background: #fff;
        border: 1px solid #ccc;
        float: left;
        margin: 5px;
    }

    .img-container {
        width: 100%;
    }

    .img-browse {
        position: absolute;
        top: 35%;
        left: 0;
        text-align: center;
        cursor: pointer;
        width: 100%;
        font-weight: normal;
        opacity: 0.5;
        transition: 0.5s;
    }

        .img-browse:hover {
            opacity: 1.5;
        }
</style>
@using (Html.BeginForm("Edit", "Staff", FormMethod.Post, new { id = "StaffForm", role = "form", enctype = "multipart/form-data" }))
{
    @*<div class="form-group row ml-2">
        <div class="col-md-10">
            <div class="row">
                <div class="col-md-3">
                    <button type="button" id="GeneratePassword" class="btn btn-success">Generate Password</button>
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" name="Password" id="Password" value="@Model.Password" readonly />
                </div>
            </div>
        </div>
        <div class="col-md-2 my-3">
            <a href="~/Staff/List" class="ml-auto" target="_self"><u>Staff List</u></a>
        </div>
    </div>*@
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <h5 class="text-success" style="letter-spacing:1px">STAFF EDIT</h5>
            </div>
            <div class="col-md-2">
                <button type="button" id="GeneratePassword" class="btn btn-sm btn-info mb-2">Generate Password</button>
            </div>
            <div class="col-md-2">
                <input type="text" class="form-control form-control-sm mb-2" name="Password" id="Password" value="@Model.Password" readonly />
            </div>
            <div class="col-md-5 text-right">
                <a href="~/Staff/List" target="_blank"><span class="fa fa-bars"></span>&nbsp;Staff List</a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 mx-auto">
                <div class="card">               
                    <div class="card-body">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="Code" id="Code" value="@Model.Code" />
                        <input type="hidden" name="IpAddress" value="@Model.IpAddress" />
                        <input type="hidden" name="CustomerCode" value="@Model.CustomerCode" />
                        <input type="hidden" name="CustomerName" value="@Model.CustomerName" />
                        <input type="hidden" name="ImagePath" value="@Model.ImagePath" />
                        <div class="form-group row">
                            <div class="col-md-3">
                                <label class="col-form-label"><strong class="text-secondary">Staff Name</strong></label>
                                <input id="Name" type="text" class="form-control" name="Name" value="@Model.Name" />
                            </div>
                            <div class="col-md-3">
                                <label class="col-form-label"><strong class="text-secondary">Mobile Number</strong></label>
                                <input id="PhoneNumber" type="text" class="form-control" name="PhoneNumber" value="@Model.PhoneNumber" />
                            </div>
                            <div class="col-md-3 mt-1">
                                <label class="control-label" for="ShopName"><strong class="text-secondary">Shop Name</strong></label>
                                <select id="ShopCode" name="ShopCode" class="form-control">
                                    <option value="@Model.ShopCode">@Model.ShopName</option>
                                </select>
                                <input type="hidden" name="ShopName" id="ShopName" value="@Model.ShopName" />
                            </div>
                            <div class="col-md-2">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="img-upload-container ml-2 mt-xl-4">
                                            @if (Model.ImagePath != null)
                                            {
                                                <a href="~/Home/ImageDenied">
                                                    <img id='img-upload' class="img-container w-100 h-100" src="https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/@Model.ImagePath" onerror="this.src='/Images/No Photo.png'" />
                                                </a>
                                            }
                                            else
                                            {
                                                <img id='img-upload' class="img-container w-100 h-100" />
                                            }
                                            <input type="file" id="StaffImage" name="StaffImage" class="d-none" />
                                            <label for="StaffImage" class="img-browse"><span class="fa fa-plus"></span> Select Image</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3 mx-auto">
                                <button type="button" class="btn btn-block btn-success Save"><span class="glyphicon glyphicon-file"></span> Save</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
}
@section Scripts
{
    <!--Select2-->
    <script src="~/Scripts/select2/js/select2.js"></script>
    <link href="~/Scripts/select2/css/select2.css" rel="stylesheet" />
    <link href="~/Content/select2/select2.custom.css" rel="stylesheet" />
    <!--Select2 End-->
    <script src="~/Scripts/ValidateRequiredFields.js"></script>
    <!--Image Upload-->
    <script src="~/Scripts/multiple-image-upload.js"></script>
    <link href="~/Content/multiple-image-upload.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {
            $(function () {
                $('#GeneratePassword').click(function () {
                    var code = $('#Code').val();
                    $.getJSON("/Staff/GeneratePassword?Code=" + code, function (data) {
                        $('#Password').val(data.data);
                        $("#GeneratePassword").attr('disabled', true);
                    });
                });
            });

            var password = $("#Password").val();
            if (password != "") {
                $("#GeneratePassword").attr('disabled', true);
            }

            $(".Save").click(function () {
                var isValidated = false;
                var requiredArr = [
                    'Name',
                    'PhoneNumber',
                    'ShopCode'
                ];
                isValidated = ValidateEmptyRequiredFiels(requiredArr);

                if (isValidated) {
                    $('#StaffForm').submit();
                    $('.Save').prop('disabled', true);
                };
            });

            $('#ShopCode').select2({
                placeholder: "Search Shop",
                ajax: {
                    url: "/Staff/GetShopSelect2",
                    width: '100%',
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('input[name="ShopName"]').val(e.params.data.text);
            });

            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#img-upload').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            $("#StaffImage").change(function () {
                readURL(this);
            });

        });
    </script>
}


