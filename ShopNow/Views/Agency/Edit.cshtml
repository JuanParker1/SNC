@model ShopNow.ViewModels.AgencyEditViewModel
@{
    ViewBag.Title = "Agency Update";
}
<title>ShopNow | @ViewBag.Title</title>

<div class="container-fluid">
    <div class="row mb-2">
        <div class="col-md-3">
            <h5 class="text-success">@ViewBag.Title</h5>
        </div>
        <div class="col-md-9 text-right">
            @if (Model.Status == 1)
            {
                <a href="~/Agency/Approve?Id=@Model.Id" class="btn btn-success btn-sm mr-2">Approve</a>
                <a href="~/Agency/Reject?Id=@Model.Id" class="btn btn-danger text-center text-nowrap btn-sm mr-2">Reject</a>
            }
            <a href="~/Agency/List" target="_self"><span class="fa fa-list-ul"></span> Agency List</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 mx-auto">
            @using (Html.BeginForm("Edit", "Agency", FormMethod.Post, new { id = "AgencyForm", role = "form", enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                <input type="hidden" name="Id" value="@Model.Id" />
                <input type="hidden" name="Status" value="@Model.Status" />
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <label class="col-form-label"><strong class="text-secondary">Agency Name</strong></label>
                                        <div class="DeliverBoyName">
                                            <input id="Name" type="text" class="form-control" name="Name" maxlength="100" oninput="this.value=this.value.replace(/[^a-zA-Z ]/g, '');" value="@Model.Name" />
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="col-form-label"><strong class="text-secondary">Mobile Number</strong></label>
                                        <input type="text" class="form-control" name="PhoneNumber" id="PhoneNumber" readonly value="@Model.PhoneNumber" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="col-form-label"><strong class="text-secondary">Email</strong></label>
                                        <input type="email" class="form-control" name="Email" id="Email" value="@Model.Email" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group row">
                                    <div class="col-md-5">
                                        <div class="row ml-2">
                                            <input class="col-11 mb-2" id="pac-input" type="text" placeholder="Select your Place" />
                                            <div id="location-error"></div>
                                            <div class="" id="map" style="width: 92%; height: 250px;"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <label class="col-form-label"><strong class="text-secondary">Agency Preference Area</strong></label>
                                                <input id="Address" type="text" class="form-control mb-2" name="Address" value="@Model.Address" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <small class="control-label" for="StreetName"><i class="text-secondary">Locality</i></small>
                                                <input id="StreetName" type="text" class="form-control mb-2" name="StreetName" value="@Model.StreetName" />
                                            </div>
                                            <div class="col-md-4">
                                                <small class="control-label" for="DistrictName"><i class="text-secondary">District</i></small>
                                                <input id="DistrictName" type="text" class="form-control" name="DistrictName" value="@Model.DistrictName" />
                                            </div>
                                            <div class="col-md-4">
                                                <small class="control-label" for="StateName"><i class="text-secondary">State / Province</i></small>
                                                <input id="StateName" type="text" class="form-control mb-2" name="StateName" value="@Model.StateName" />
                                            </div>
                                            <div class="col-md-4">
                                                <small class="control-label" for="CountryName"><i class="text-secondary">Country</i></small>
                                                <input id="CountryName" type="text" class="form-control" name="CountryName" value="@Model.CountryName" />
                                            </div>
                                            <div class="col-md-4">
                                                <small class="control-label" for="PinCode"><i class="text-secondary">PIN Code</i></small>
                                                <input id="PinCode" type="text" class="form-control" name="PinCode" value="@Model.PinCode" />
                                            </div>
                                            <div class="col-md-4"></div>
                                            <div class="col-md-4">
                                                <small class="control-label col-sm-12" for="Latitude"><i class="text-secondary">Latitude</i></small>
                                                <input id="Latitude" type="text" class="form-control mb-2" placeholder="Latitude" name="Latitude" readonly value="@Model.Latitude" />
                                            </div>
                                            <div class="col-md-4">
                                                <small class="control-label col-sm-12" for="Longitude"><i class="text-secondary">Longitude</i></small>
                                                <input id="Longitude" type="text" class="form-control" placeholder="Longitude" name="Longitude" readonly value="@Model.Longitude" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mx-2">
                                <div class="col-md-12">
                                    <div class="card-deck">
                                        <div class="card border-info">
                                            <div class="card-body text-center">
                                                <div class="row text-center">
                                                    <div class="col-md-12"><label class="text-secondary font-weight-bold">Image</label></div>
                                                    <div class="col-md-12"><label class="small font-italic">* Upload recent photo</label></div>
                                                </div>
                                                <div class="row ml-5 mt-2">
                                                    <div class="col-md-12">
                                                        <div class="img-upload-container mb-3">
                                                            @if (Model.ImagePath != null)
                                                            {
                                                                <img class="img-container w-100 h-100 mb-2" id="img-upload" src="https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/@Model.ImagePath" onerror="this.src='/Images/No Photo.png'" />
                                                            }
                                                            else
                                                            {
                                                                <img id='img-upload' class="img-container w-100 h-100" />
                                                            }
                                                            <input type="file" id="AgencyImage" name="AgencyImage" class="d-none" />
                                                            <label for="AgencyImage" class="img-browse"><span class="fa fa-plus"></span> Select Image</label>
                                                            <input type="hidden" name="ImagePath" value="@Model.ImagePath" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card border-info bg-muted">
                                            <div class="card-body">
                                                <label class="col-md-12 text-center"><strong class="text-secondary">Pan </strong></label>
                                                <label class="col-md-12 text-left"><small class="text-secondary"><i>Pan Number</i></small></label>
                                                <input id="PanNumber" type="text" class="form-control" name="PanNumber" value="@Model.PanNumber" />
                                                <label class="col-md-12 mt-2"><small class="text-secondary"><i>Pan Image</i></small></label>
                                                <div class="row ml-3 PanImg mt-2">
                                                    <div class="img-upload-container mb-3">
                                                        @if (Model.ImagePanPath != null)
                                                        {
                                                            <img class="img-container w-100 h-100 mb-2" id="img-pan" src="https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/@Model.ImagePanPath" onerror="this.src='/Images/No Photo.png'" />
                                                        }
                                                        else
                                                        {
                                                            <img id='img-pan' class="img-container w-100 h-100" />
                                                        }
                                                        <input type="file" id="PanImage" name="PanImage" class="d-none" />
                                                        <label for="PanImage" class="img-browse"><span class="fa fa-plus"></span> Select Image</label>
                                                        <input type="hidden" name="ImagePanPath" value="@Model.ImagePanPath" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card border-info">
                                            <div class="card-body text-center">
                                                <label class="col-md-12 text-center"><strong class="text-secondary">Bank Account</strong></label>
                                                <label class="col-md-12"><small class="text-secondary"><i>Bank Passbook Image</i></small></label>
                                                <div class="row">
                                                    <div class="img-upload-container mx-auto mb-3 AccountDocumentImg">
                                                        @if (Model.BankPassbookPath != null)
                                                        {
                                                            <img class="img-container w-100 h-100 mb-2" id="img-account" src="https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/@Model.BankPassbookPath" onerror="this.src='/Images/No Photo.png'" />
                                                        }
                                                        else
                                                        {
                                                            <img id='img-account' class="img-container w-100 h-100" />
                                                        }
                                                        <input type="file" id="BankPassbookImage" name="BankPassbookImage" class="d-none" />
                                                        <label for="BankPassbookImage" class="img-browse"><span class="fa fa-plus"></span> Select Image</label>
                                                        <input type="hidden" name="BankPassbookPath" value="@Model.BankPassbookPath" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row m-3">
                        <div class="col-md-12">
                            <h5 class="text-success mb-2">Bank Details</h5>
                            <div class="form-group row">
                                <div class="form-group col-md-4">
                                    <small class="col-form-label" for="BankName"><i class="text-secondary">Bank Name</i></small>
                                    <input id="BankName" type="text" class="form-control" name="BankName" value="@Model.BankName" />
                                </div>
                                <div class="form-group col-md-4">
                                    <small class="col-form-label" for="AccountName"><i class="text-secondary">Account Name</i></small>
                                    <input id="AccountName" type="text" class="form-control" name="AccountName" value="@Model.AccountName" />
                                </div>
                                <div class="form-group col-md-4">
                                    <small class="col-form-label" for="AccountNumber"><i class="text-secondary">Account Number</i></small>
                                    <input id="AccountNumber" type="text" class="form-control" name="AccountNumber" value="@Model.AccountNumber" />
                                </div>
                                <div class="form-group col-md-4">
                                    <small class="col-form-label" for="IFSCCode"><i class="text-secondary">IFSC Code</i></small>
                                    <input id="IFSCCode" type="text" class="form-control" name="IFSCCode" value="@Model.IFSCCode" />
                                </div>
                                <div class="form-group col-md-4">
                                    <small class="col-form-label" for="SwiftCode"><i class="text-secondary">SwiftCode</i></small>
                                    <input id="SwiftCode" type="text" class="form-control" name="SwiftCode" value="@Model.SwiftCode" />
                                </div>
                                <div class="form-group col-md-4">
                                    <small class="col-form-label" for="UPIID"><i class="text-secondary">UPI</i></small>
                                    <input id="UPIID" type="text" class="form-control" name="UPIID" value="@Model.UPIID" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <div class="col-md-3 mx-auto">
                            <button type="button" class="btn btn-block btn-success" id="Create"><span class="glyphicon glyphicon-file"></span>Submit</button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
@section Scripts
{
    <script src="~/Scripts/ValidateRequiredFields.js"></script>
    <script src="~/Scripts/sweetalert/sweetalert.min.js"></script>
    <link href="~/Content/sweetalert/sweetalert.css" rel="stylesheet" />
    <!--Select2-->
    <script src="~/Scripts/select2/js/select2.js"></script>
    <link href="~/Scripts/select2/css/select2.css" rel="stylesheet" />
    <link href="~/Content/select2/select2.custom.css" rel="stylesheet" />
    <!--Select2 End-->
    <script src="~/Scripts/multiple-image-upload.js"></script>
    <link href="~/Content/multiple-image-upload.css" rel="stylesheet" />
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRsR3Wpkj_Vofy5FSU0otOx-6k-YFiNBk&libraries=places&callback=initMap"
            async defer></script>
    <script>
        $(document).ready(function () {

            $('#Create').on('click', function () {
                var isValidated = false;
                var requiredArr = [
                    'Name',
                    'PhoneNumber',
                    'Email'
                ];
                isValidated = ValidateEmptyRequiredFiels(requiredArr);
                if (isValidated) {
                    $('#AgencyForm').submit();
                }
            });

            $('input:radio[name="DrivingLicense"]').change(
                function () {
                    if (this.checked && this.value == 'Image') {
                        $('.DrivingImg').removeClass('d-none');
                        $('.DrivingPdf').addClass('d-none');
                        $("#DrivingLicensePdf").val("");
                    } else {
                        $('.DrivingImg').addClass('d-none');
                        $('.DrivingPdf').removeClass('d-none');
                        $("#DrivingLicenseImage").val("");
                        $("#img-license").attr('src', '');
                    }
                });

            $('input:radio[name="AccountDocument"]').change(
                function () {
                    if (this.checked && this.value == 'Image') {
                        $('.AccountDocumentImg').removeClass('d-none');
                        $('.AccountDocumentPdf').addClass('d-none');
                        $("#BankPassbookPdf").val("");
                    } else {
                        $('.AccountDocumentImg').addClass('d-none');
                        $('.AccountDocumentPdf').removeClass('d-none');
                        $("#BankPassbookImage").val("");
                        $("#img-account").attr('src', '');
                    }
                });

            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#img-upload').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            function readURLlicense(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#img-pan').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            function readURLaccount(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#img-account').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            $("#AgencyImage").change(function () {
                readURL(this);
            });

            $("#PanImage").change(function () {
                readURLlicense(this);
            });

            $("#BankPassbookImage").change(function () {
                readURLaccount(this);
            });


        });


        var map, infoWindow, markers = [];
        function initMap() {

            var latitude = parseFloat($('#Latitude').val());
            var longitude = parseFloat($('#Longitude').val());
            var center = new google.maps.LatLng(latitude, longitude);
            var card = document.getElementById('pac-card');
            var input = document.getElementById('pac-input');
            var autocomplete = new google.maps.places.Autocomplete(input);
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: latitude, lng: longitude },
                zoom: 13
            });

            infoWindow = new google.maps.InfoWindow;
            var pos = {
                lat: latitude,
                lng: longitude
            };

            var marker = new google.maps.Marker({
                position: pos,
                map: map,
                title: "your place"
            });
            google.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });
            markers.push(marker);

            autocomplete.addListener('place_changed', function () {
                document.getElementById("location-error").style.display = 'none';
                markers.forEach(function (marker) {
                    marker.setMap(null);
                });

                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    document.getElementById("location-error").style.display = 'inline-block';
                    document.getElementById("location-error").innerHTML = "Cannot Locate '" + input.value + "' on map";
                    return;
                }
                var marker = new google.maps.Marker({
                    position: pos,
                    map: map,
                    title: "your place"
                });

                google.maps.event.addListener(marker, 'click', function () {
                    infowindow.open(map, marker);
                });
                markers.push(marker);

                map.fitBounds(place.geometry.viewport);
                marker.setPosition(place.geometry.location);
                marker.setVisible(true);
                console.log(place);

                $('#Address').val(place.formatted_address);
                var address = place.address_components;
                $.each(address, function () {

                    if (this.types[0] == "locality") {
                        $('#StreetName').val(this.long_name);
                    }
                    if (this.types[0] == "administrative_area_level_2") {
                        $('#DistrictName').val(this.long_name);
                    }
                    if (this.types[0] == "administrative_area_level_1") {
                        $('#StateName').val(this.long_name);
                    }
                    if (this.types[0] == "country") {
                        $('#CountryName').val(this.long_name);
                    }
                    if (this.types[0] == "postal_Id") {
                        $('#PinCode').val(this.long_name);
                    }
                });
                $('#Latitude').val(place.geometry.location.lat);
                $('#Longitude').val(place.geometry.location.lng);

            });
        }

    </script>
}

