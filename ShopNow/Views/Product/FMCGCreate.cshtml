@model ShopNow.ViewModels.FMCGCreateViewModel
@{
    ViewBag.Title = "FMCG Entry";
}
<title>ShopNow | @ViewBag.Title</title>
<div class="container-fluid">
    <div class="row my-2">
        <div class="col-md-6">
            <h5 class="text-success" style="letter-spacing:1px">@ViewBag.Title</h5>
        </div>
        <div class="col-md-6 text-right">
            <a href="~/Product/FMCGList" target="_self" class="mr-3"><span class="fa fa-list-ul"></span> FMCG List</a>
            <a href="~/Product/List" target="_self"><span class="fa fa-list-ul"></span> Full List</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 mx-auto">
            @using (Html.BeginForm("FMCGCreate", "Product", FormMethod.Post, new { id = "FMCGCreateForm", enctype = "multipart/form-data", autocomplete = "off" }))
            {
                @Html.AntiForgeryToken()
                <div class="card shadow-sm mb-3">
                    <div class="card-body">
                        <div class="col-md-12">
                            <div class="form-group row">
                                <div class="col-md-2"></div>
                                <div class="col-md-2 text-md-left">
                                    <label class="col-form-label text-secondary font-weight-bold">Shop Name</label>
                                </div>
                                <div class="col-md-4">
                                    <select id="ShopId" name="ShopId" class="form-control"></select>
                                    <input type="hidden" name="ShopName" id="ShopName" />
                                    <input type="hidden" name="ShopPricePercentage" id="ShopPricePercentage" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card shadow">
                    <div class="card-body">
                        <div class="form-group row">
                            <div class="col-md-12">
                                <div class="form-group row">
                                    <div class="col-md-3">
                                        <label class="col-form-label"><strong class="text-secondary">FMCG Name</strong></label>
                                        <select name="MasterProductId" id="MasterProductId" class="form-control"></select>
                                        <input type="hidden" name="MasterProductName" id="MasterProductName" />
                                        <input type="hidden" name="Name" id="Name" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label"><strong class="text-secondary">Brand Name</strong></label>
                                        <input type="text" class="form-control" name="BrandName" id="BrandName" readonly />
                                        <input type="hidden" name="BrandId" id="BrandId" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label"><strong class="text-secondary">Category Name</strong></label>
                                        <select id="CategoryId" name="CategoryId" class="form-control"></select>
                                        <input type="hidden" name="CategoryName" id="CategoryName" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label"><strong class="text-secondary">Sub Category I Name</strong></label>
                                        <select id="SubCategoryId" name="SubCategoryId" class="form-control"></select>
                                        <input type="hidden" name="SubCategoryName" id="SubCategoryName" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label"><strong class="text-secondary">Sub Category II Name</strong></label>
                                        <select id="NextSubCategoryId" name="NextSubCategoryId" class="form-control"></select>
                                        <input type="hidden" name="NextSubCategoryName" id="NextSubCategoryName" />
                                    </div>
                                    <div class="col-md-3">
                                        <label><strong class="text-secondary">Measurement Unit Name</strong></label>
                                        <input type="text" class="form-control" name="MeasurementUnitName" id="MeasurementUnitName" readonly />
                                        <input type="hidden" name="MeasurementUnitId" id="MeasurementUnitId" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label" for="MenuPrice"><strong class="text-secondary">Menu Price</strong></label>
                                        <input id="MenuPrice" type="number" class="form-control" name="MenuPrice" min="1" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label" for="Price"><strong class="text-secondary">Selling Price</strong></label>
                                        <input id="Price" type="number" class="form-control" name="Price" min="1" />
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label class="col-form-label" for="ShopPrice"><strong class="text-secondary">Shop Price</strong></label>
                                            <input id="ShopPrice" type="number" class="form-control" name="ShopPrice" min="1" step="any" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label class="col-form-label" for="Qty"><strong class="text-secondary">Quantity</strong></label>
                                            <input id="Qty" type="number" class="form-control" name="Qty" min="0" />
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label class="col-form-label" for="Percentage"><strong class="text-secondary">Percentage</strong></label>
                                            <input id="Percentage" type="number" class="form-control" name="Percentage" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="col-form-label" for="DiscountCategoryName"><strong class="text-secondary">Discount Category Name</strong></label>
                                            <select class="form-control" id="DiscountCategoryId" name="DiscountCategoryId"></select>
                                            <input type="hidden" id="DiscountCategoryName" name="DiscountCategoryName" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="col-form-label" for="DiscountCategoryPercentage"><strong class="text-secondary">Discount Percentages</strong></label>
                                            <input type="number" class="form-control" id="DiscountCategoryPercentage" name="DiscountCategoryPercentage" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label" for="Weight"><strong class="text-secondary">Weight</strong></label>
                                        <input id="Weight" type="number" class="form-control" name="Weight" step="any" min="0" readonly />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label" for="SizeLBH"><strong class="text-secondary">Size LB</strong></label>
                                        <input id="SizeLBH" type="text" class="form-control" name="SizeLBH" min="0" readonly />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label" for="PackageId"><strong class="text-secondary">Package Name</strong></label>
                                        <input type="text" class="form-control" name="PackageName" id="PackageName" readonly />
                                        <input type="hidden" name="PackageId" id="PackageId" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label"><strong class="text-secondary">ASIN / EAN</strong></label>
                                        <input id="ASIN" type="text" class="form-control" name="ASIN" readonly />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label" for="GoogleTaxonomyCode"><strong class="text-secondary">Google Taxonomy Code</strong></label>
                                        <input id="GoogleTaxonomyCode" type="text" class="form-control" name="GoogleTaxonomyCode" readonly />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="col-form-label" for="PackingType"><strong class="text-secondary">Packing Type</strong></label>
                                        <div class="form-check-inline ml-3">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" name="PackingType" value="0" checked>Item Qty
                                            </label>
                                        </div>
                                        <div class="form-check-inline">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" name="PackingType" value="1">SKU
                                            </label>
                                        </div>
                                        <input type="number" class="form-control" name="PackingCharge" id="PackingCharge" />
                                    </div>
                                    <div class="d-flex mt-5">
                                        <div class="mx-3">
                                            <input type="checkbox" id="IsPreorder" name="IsPreorder" value="true">
                                            <label class="font-weight-bold text-secondary col-form-label" for="IsPreorder"> Is PreOrder</label><br>
                                        </div>
                                        <div class="ml-3">
                                            <select name="PreorderHour" id="PreorderHour" class="form-control d-none">
                                                <option value="0" selected disabled>Select Hours</option>
                                                @for (int i = 2; i <= 24; i++)
                                                {
                                                    <option value="@i">@i hours</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-12  form-group">
                                        <label class="col-form-label" for="ShortDescription"><strong class="text-secondary">Short Description</strong></label>
                                        <input id="ShortDescription" type="text" class="form-control" name="ShortDescription" min="0" readonly />
                                    </div>
                                    <div class="col-md-12 form-group">
                                        <label class="control-label"><strong class="text-secondary">Long Description</strong></label>
                                        <div id="LongDescription"></div>
                                        @*<textarea class="form-control" id="LongDescription" name="LongDescription" rows="8" cols="50" readonly></textarea>*@
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-4 form-group">
                                        <label class="control-label text-secondary font-weight-bold ml-2">FMCG Image1</label>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <img class="img-container" id="img-FMCGImage1" src="/Images/No Photo.png" onerror="this.src='/Images/noimage.png'" style="width:120px;height:120px;" />
                                                <input type="hidden" name="ImagePath1" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 form-group">
                                        <label class="control-label text-secondary font-weight-bold ml-2">FMCG Image2</label>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <img class="img-container" id="img-FMCGImage2" src="/Images/No Photo.png" onerror="this.src='/Images/noimage.png'" style="width:120px;height:120px;" />
                                                <input type="hidden" name="ImagePath2" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 form-group">
                                        <label class="control-label text-secondary font-weight-bold ml-2">FMCG Image3</label>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <img class="img-container" id="img-FMCGImage3" src="/Images/No Photo.png" onerror="this.src='/Images/noimage.png'" style="width:120px;height:120px;" />
                                                <input type="hidden" name="ImagePath3" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 form-group">
                                        <label class="control-label text-secondary font-weight-bold ml-2">FMCG Image4</label>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <img class="img-container" id="img-FMCGImage4" src="/Images/No Photo.png" onerror="this.src='/Images/noimage.png'" style="width:120px;height:120px;" />
                                                <input type="hidden" name="ImagePath4" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 form-group">
                                        <label class="control-label text-secondary font-weight-bold ml-2">FMCG Image5</label>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <img class="img-container" id="img-FMCGImage5" src="/Images/No Photo.png" onerror="this.src='/Images/noimage.png'" style="width:120px;height:120px;" />
                                                <input type="hidden" name="ImagePath5" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-2 mx-auto">
                                <button type="button" class="btn btn-block btn-success Save"><span class="glyphicon glyphicon-file"></span> Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts
{
    <!--Select2-->
    <script src="~/Scripts/select2/js/select2.js"></script>
    <link href="~/Scripts/select2/css/select2.css" rel="stylesheet" />
    <link href="~/Content/select2/select2.custom.css" rel="stylesheet" />
    <!--Select2 End-->
    <script src="~/Scripts/ValidateRequiredFields.js"></script>
    <script src="~/Scripts/multiple-image-upload.js"></script>
    <link href="~/Content/multiple-image-upload.css" rel="stylesheet" />
    <script src="~/Scripts/sweetalert/sweetalert.min.js"></script>
    <link href="~/Content/sweetalert/sweetalert.css" rel="stylesheet" />

    <script>

        $(document).ready(function () {
            var errormsg = "@ViewBag.ErrorMessage";
            var msg = "@ViewBag.Message";
            if (errormsg != "") {
                swal("Notice!", errormsg, "error")
            }
            if (msg != "") {
                swal("Success!", msg, "success")
            }

            $('#Price').on('change keyup', function () {
                var menuprice = $("#MenuPrice").val();
                var sellingprice = $(this).val();
                var results = Math.ceil(((menuprice - sellingprice) / menuprice) * 100);
                $("#Percentage").val(results);
                calculateShopPrice(menuprice, $("#ShopPricePercentage").val(), sellingprice, results)
            });

            $('#MenuPrice').on('change keyup', function () {
                var menuprice = $(this).val();
                var sellingprice = $('#Price').val();
                var results = Math.ceil(((menuprice - sellingprice) / menuprice) * 100);
                $("#Percentage").val(results);
                calculateShopPrice(menuprice, $("#ShopPricePercentage").val(), sellingprice, results);
            });

            $('#IsPreorder').change(function () {
                if (this.checked) {
                    $("#PreorderHour").removeClass('d-none');
                } else {
                    $("#PreorderHour").addClass('d-none');
                    $("#PreorderHour").val(0);
                }
            });

            $('#ShopId').select2({
                placeholder: "Search Shop",
                ajax: {
                    url: "/Product/GetFMCGShopSelect2",
                    width: '100%',
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('input[name="ShopName"]').val(e.params.data.textSave);
                $('input[name="ShopPricePercentage"]').val(e.params.data.percentage);
            });

            $('#CategoryId').select2({
                placeholder: "Search Category",
                ajax: {
                    url: "/Product/GetFMCGCategorySelect2",
                    width: '100%',
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('input[name="CategoryName"]').val(e.params.data.text);
            });

            $('#SubCategoryId').select2({
                placeholder: "Search Category",
                ajax: {
                    url: "/Product/GetFMCGSubCategorySelect2",
                    width: '100%',
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('input[name="SubCategoryName"]').val(e.params.data.text);
            });

            $('#NextSubCategoryId').select2({
                placeholder: "Search Category",
                ajax: {
                    url: "/Product/GetFMCGNextSubCategorySelect2",
                    width: '100%',
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('input[name="NextSubCategoryName"]').val(e.params.data.text);
            });

            $('#DiscountCategoryId').select2({
                placeholder: "Search Discount Category",
                width: '100%',
                ajax: {
                    url: "/Product/GetDiscountCategorySelect2",
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('input[name="DiscountCategoryName"]').val(e.params.data.text);
                $('input[name="DiscountCategoryPercentage"]').val(e.params.data.percentage);
            });

            $('#MasterProductId').select2({
                placeholder: "Search Product",
                ajax: {
                    url: "/Product/GetFMCGSelect2",
                    width: '100%',
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('#LongDescription').text("");
                $('select[name="CategoryId"]').find('option').remove();
                $('select[name="SubCategoryId"]').find('option').remove();
                $('select[name="NextSubCategoryId"]').find('option').remove();
                $('input[name="MasterProductName"]').val(e.params.data.text);
                $('input[name="Name"]').val(e.params.data.text);
                $('#BrandId').val(e.params.data.BrandId);
                $('#BrandName').val(e.params.data.BrandName);
                $('#ASIN').val(e.params.data.ASIN);
                $('select[name="CategoryId"]').append('<option value=' + e.params.data.CategoryId + '>' + e.params.data.CategoryName + '</option>')
                $('input[name="CategoryName"]').val(e.params.data.CategoryName);
                $('select[name="SubCategoryId"]').append('<option value=' + e.params.data.SubCategoryId + '>' + e.params.data.SubCategoryName + '</option>')
                $('input[name="SubCategoryName"]').val(e.params.data.SubCategoryName);
                $('select[name="NextSubCategoryId"]').append('<option value=' + e.params.data.NextSubCategoryId + '>' + e.params.data.NextSubCategoryName + '</option>')
                $('input[name="NextSubCategoryName"]').val(e.params.data.NextSubCategoryName);
                $('#GoogleTaxonomyCode').val(e.params.data.GoogleTaxonomyCode);
                $('#img-FMCGImage1').attr('src', 'https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/' + e.params.data.ImagePath1);
                $('#img-FMCGImage2').attr('src', 'https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/' + e.params.data.ImagePath2);
                $('#img-FMCGImage3').attr('src', 'https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/' + e.params.data.ImagePath3);
                $('#img-FMCGImage4').attr('src', 'https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/' + e.params.data.ImagePath4);
                $('#img-FMCGImage5').attr('src', 'https://s3.ap-south-1.amazonaws.com/shopnowchat.com/Medium/' + e.params.data.ImagePath5);
                $('input[name="ImagePath1"]').val(e.params.data.ImagePath1);
                $('input[name="ImagePath2"]').val(e.params.data.ImagePath2);
                $('input[name="ImagePath3"]').val(e.params.data.ImagePath3);
                $('input[name="ImagePath4"]').val(e.params.data.ImagePath4);
                $('input[name="ImagePath5"]').val(e.params.data.ImagePath5);
                $('#MenuPrice').val(e.params.data.Price);
                calculateShopPrice(e.params.data.Price, $("#ShopPricePercentage").val(), 0,0);
                $('#Weight').val(e.params.data.Weight);
                $('#SizeLBH').val(e.params.data.SizeLBH);
                $('#ShortDescription').val(e.params.data.ShortDescription);
                $('#LongDescription').append(e.params.data.LongDescription);
                $('input[name="MeasurementUnitId"]').val(e.params.data.MeasurementUnitId);
                $('input[name="MeasurementUnitName"]').val(e.params.data.MeasurementUnitName);
                $('input[name="PackageId"]').val(e.params.data.PackageId);
                $('input[name="PackageName"]').val(e.params.data.PackageName);
                //if (e.params.data.CategoryId != 0 && e.params.data.SubCategoryId != 0 && e.params.data.NextSubCategoryId != 0) {
                //$.getJSON("/Product/GetSelectCategoryNames", { categoryId: e.params.data.CategoryId, subcategoryId: e.params.data.SubCategoryId, nextsubcategoryId: e.params.data.NextSubCategoryId }, function (data) {
                //    $('#CategoryName').val(data.categoryName);
                //    $('#SubCategoryName').val(data.subcategoryname);
                //    $('#NextSubCategoryName').val(data.nextsubcategoryname);
                //});
                //}
            });

            $(".Save").click(function () {
                var isValidated = false;
                var requiredArr = [
                    'MenuPrice',
                    'Price',
                    'ShopId',
                    'MasterProductId'
                ];
                isValidated = ValidateEmptyRequiredFiels(requiredArr);
                if (isValidated) {
                    $('#FMCGCreateForm').submit();
                    $(".Save").prop("disabled", true);
                };
                //var shopid = $("#ShopId").val();
                //if (shopid != null) {
                //    if ($('#MasterProductId').val()) {
                //        $('#FMCGCreateForm').submit();
                //    } else {
                //        swal("Notice!", "Please Select FMCG!", "warning");
                //    }
                //} else {
                //    swal("Notice!", "Please Select Shop!", "warning");
                //}
            });
        });

        function calculateShopPrice(menuprice, shoppercentage, sellingprice, percentage) {
            if (shoppercentage != 0 && percentage == 0) {
                var shopprice = (menuprice - (menuprice * (shoppercentage / 100)));
                $('#ShopPrice').val(shopprice);
            } else if (shoppercentage != 0 && percentage != 0) {
                var shopprice = (sellingprice - (sellingprice * (shoppercentage / 100)));
                $('#ShopPrice').val(shopprice);
            } else if (shoppercentage == 0 && percentage == 0) {
                $('#ShopPrice').val(menuprice);
            } else {
                $('#ShopPrice').val(sellingprice);
            }
        }
    </script>
}
