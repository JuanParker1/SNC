@model ShopNow.ViewModels.BannerCreateEditViewModel
@{
    ViewBag.Title = "Create";
}
<title>ShopNow | Banner Create</title>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6">
            <h5 class="text-success" style="letter-spacing:1px">Banner Entry</h5>
        </div>
        <div class="col-md-6 text-right">
            <a href="~/Banner/List" target="_self"><span class="fa fa-bars"></span>&nbsp;Banner List</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 mx-auto">
            @using (Html.BeginForm("Create", "Banner", FormMethod.Post, new { id = "BannerForm", enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-9">
                                <div class="form-group row">
                                    <div class="col-md-3 text-md-left">
                                        <label class="col-form-label text-secondary font-weight-bold">Shop Name*</label>
                                    </div>
                                    <div class="col-md-9">
                                        <select id="ShopId" name="ShopId" class="form-control"></select>
                                        <input type="hidden" name="ShopName" id="ShopName" />
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-md-3 text-md-left">
                                        <label class="col-form-label text-secondary font-weight-bold">Campaign Type</label>
                                    </div>
                                    <div class="col-md-9 mt-2">
                                        <div class="row mx-auto">
                                            <span class="col-md-3">
                                                <label class="form-check-label">
                                                    <input type="radio" class="form-check-input" name="Type" value="Shop" checked>Shop Campaign
                                                </label>
                                            </span>
                                            <span class="col-md-3">
                                                <label class="form-check-label">
                                                    <input type="radio" class="form-check-input" name="Type" value="Product">Product Campaign
                                                </label>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row d-none ProductBanner">
                                    <div class="col-md-3 text-md-left">
                                        <label class="col-form-label text-secondary font-weight-bold">Product Name*</label>
                                    </div>
                                    <div class="col-md-9">
                                        <select id="ProductId" name="ProductId" class="form-control" style="width: 100%"></select>
                                        <input type="hidden" name="ProductName" id="ProductName" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-3 text-md-left">
                                        <label class="col-form-label text-secondary font-weight-bold">Campaign Name</label>
                                    </div>
                                    <div class="col-md-9">
                                        <input type="text" class="form-control" name="BannerName" id="BannerName" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-3 text-md-left">
                                        <label class="col-form-label text-secondary font-weight-bold">Select Section*</label>
                                    </div>
                                    <div class="col-md-9">
                                        <select class="form-control" name="Position" id="Position">
                                            <option value="0">Select Disply Area</option>
                                            <option value="1">Top</option>
                                            <option value="2">Bottom</option>
                                            <option value="3">My Shop Category(Health,Groceries, etc.)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-3 text-md-left">
                                        <label class="col-form-label text-secondary font-weight-bold">Select Date*</label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-daterange input-group">
                                            <input type="date" class="form-control" name="Fromdate" id="Fromdate" placeholder="From Date">
                                            <span class="input-group-addon mx-3">to</span>
                                            <input type="date" class="form-control" name="Todate" id="Todate" placeholder="To Date">

                                        </div>
                                    </div>
                                    <div class="col-md-1 text-md-left">
                                        <label class="col-form-label text-secondary font-weight-bold">Days</label>
                                    </div>
                                    <div class="col-md-2 text-md-left">
                                        <input type="text" name="Days" id="Days" class="form-control" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="row">
                                    <label class="col-md-12 text-center font-weight-bold text-secondary">Banner Image</label>
                                    <div class="img-upload-container mx-auto">
                                        <img class="img-container text-center w-100 h-100" id="img-upload" />
                                        <input type="file" id="BannerImage" name="BannerImage" class="d-none" />
                                        <label for="BannerImage" class="img-browse"><span class="fa fa-plus"></span> Select Image</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row Proceed">
                            <div class="col-md-2 mt-3 mx-auto">
                                <button type="button" class="btn btn-block btn-success" id="Proceed"><span class="glyphicon glyphicon-file"></span>Proceed</button>
                            </div>
                        </div>
                        <div class="form-group row d-none Charge">
                            <div class="col-md-3"></div>
                            <div class="col-md-3">
                                <label class="col-form-label text-secondary font-weight-bold">You will be charged Rs. <span class="Amount font-weight-bold"></span></label>
                                <input type="hidden" name="Amount" id="Amount" />
                            </div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-success" id="RazorPay"><span class="glyphicon glyphicon-file"></span>Pay Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<!--Select2-->
<script src="~/Scripts/select2/js/select2.js"></script>
<link href="~/Scripts/select2/css/select2.css" rel="stylesheet" />
<link href="~/Content/select2/select2.custom.css" rel="stylesheet" />
<!--Select2 End-->
<script src="~/Scripts/multiple-image-upload.js"></script>
<link href="~/Content/multiple-image-upload.css" rel="stylesheet" />
<script src="~/Scripts/sweetalert/sweetalert.min.js"></script>
<link href="~/Content/sweetalert/sweetalert.css" rel="stylesheet" />
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    $(document).ready(function () {

        $('#ShopId').select2({
            placeholder: "Search Shop",
            ajax: {
                url: "/Banner/GetShopSelect2",
                width: '100%',
                delay: 250,
                dataType: 'json'
            }
        }).on('select2:select', function (e) {
            $('input[name="ShopName"]').val(e.params.data.text);
            var shopcode = e.params.data.id;
            $('#ProductId').select2({
                placeholder: "Search Product",
                ajax: {
                    url: "/Banner/GetShopProductSelect2/?shopcode=" + shopcode,
                    width: '100%',
                    delay: 250,
                    dataType: 'json'
                }
            }).on('select2:select', function (e) {
                $('input[name="ProductName"]').val(e.params.data.text);
            });
        });
        $(function () {
            var dtToday = new Date();
            var month = dtToday.getMonth() + 1;
            var day = dtToday.getDate() + 1;
            var year = dtToday.getFullYear();
            if (month < 10)
                month = '0' + month.toString();
            if (day < 10)
                day = '0' + day.toString();
            var maxDate = year + '-' + month + '-' + day;
            $('#Fromdate').attr('min', maxDate);
        });

        $('#Fromdate').change(function () {
            var fromdate = new Date($(this).val());

            //min date
            var month = fromdate.getMonth() + 1;
            var day = fromdate.getDate();
            var year = fromdate.getFullYear();
            if (month < 10)
                month = '0' + month.toString();
            if (day < 10)
                day = '0' + day.toString();
            var minDate = (year) + '-' + (month) + '-' + (day);
            $('#Todate').attr('min', minDate);
            $('#Fromdate').val(minDate);
            $('#Todate').val(minDate);

            // max date
            fromdate.setDate(fromdate.getDate() + 2);
            var month1 = fromdate.getMonth() + 1;
            var day1 = fromdate.getDate();
            var year1 = fromdate.getFullYear();
            if (month1 < 10)
                month1 = '0' + month1.toString();
            if (day1 < 10)
                day1 = '0' + day1.toString();
            var maxDate = year1 + '-' + month1 + '-' + day1;
            $('#Todate').attr('max', maxDate);

            // Days Calculation

            var from = new Date($("#Fromdate").val());
            var to = new Date($("#Todate").val());
            var diff = new Date(to - from);
            var days = (diff / 1000 / 60 / 60 / 24) + 1;
            $('#Days').val(days);
            var amount = days * 50;
            $(".Amount").text(amount);
            $("#Amount").val(amount);
        });

        $('#Todate').change(function () {
            var from = new Date($("#Fromdate").val());
            var to = new Date($("#Todate").val());
            var diff = new Date(to - from);
            var days = (diff / 1000 / 60 / 60 / 24) + 1;
            $('#Days').val(days);
            var amount = days * 50;
            $(".Amount").text(amount);
            $("#Amount").val(amount);
        });

        $('input[type=radio][name=Type]').change(function () {
            if (this.value == 'Shop') {
                $(".ProductBanner").addClass("d-none"); 
            }
            else if (this.value == 'Product') {
                $(".ProductBanner").removeClass("d-none");
            }
        });

        $("#Proceed").click(function () {
            var shop = $("#ShopId").val();
            var product = $("#ProductId").val();
            var position = $("#Position").val();
            var days = $("#Days").val();
            //var radio = $('input[type=radio][name=Type]').val();
            var radio = $('input[name=Type]:checked', '#BannerForm').val()

            if (radio == 'Shop') {
                if (shop == null || shop == "") {
                    swal("Notice!", "Please Select Shop Name!", "warning");
                } else if (position == 0) {
                    swal("Notice!", "Please Select Position!", "warning");
                } else if (days == 0 || days == NaN) {
                    swal("Notice!", "Please Select Date!", "warning");
                } else {
                    $(".Proceed").addClass("d-none");
                    $(".Charge").removeClass("d-none");
                    var amount = days * 50;
                    $(".Amount").text(amount);
                    $("#Amount").val(amount);
                }
            }
            else if (radio == 'Product') {
                if (shop == null || shop == "") {
                    swal("Notice!", "Please Select Shop Name!", "warning");
                } else if (product == null || product == "") {
                    swal("Notice!", "Please Select Product Name!", "warning");
                }else if (position == 0) {
                    swal("Notice!", "Please Select Position!", "warning");
                } else if (days == 0 || days == NaN) {
                    swal("Notice!", "Please Select Date!", "warning");
                } else {
                    $(".Proceed").addClass("d-none");
                    $(".Charge").removeClass("d-none");
                    var amount = days * 50;
                    $(".Amount").text(amount);
                    $("#Amount").val(amount);
                }
            }
        });

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#img-upload').attr('src', e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

        $("#BannerImage").change(function () {
            readURL(this);
        });
    });
</script>